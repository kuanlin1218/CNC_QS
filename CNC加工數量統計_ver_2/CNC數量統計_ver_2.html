<!DOCTYPE html>
<html lang="zh-TW">
    <head>
        <title>詮栩雲端資料庫</title>
        <meta charset="UTF-8">
        <!-- 響應式網站 -->
        <!-- <meta name="viewport" content="width=device-width, initial-scale=1.0"> -->
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

        <!-- Boostrap 導入程式 -->
        <!-- Boostrap 導入程式 -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>


        <!-- CSS設計 -->
        <!--<link rel="stylesheet" href="CS_cnc.css"> -->
        <style>
    /* 共用================================================================== */
                body{
                    /*-- 背景顏色，網站:css gradient --*/
                    background-image: linear-gradient(to top, #fddb92 0%, #d1fdff 100%);
                }

                h1{
                    text-align: center; /*文字置中*/
                    color:rgb(21, 21, 21);
                    padding:5px; /*空間*/
                    letter-spacing: 10px; /*文字間距*/
                }

                h2{
                    text-align: center; /*文字置中*/
                    color:rgb(21, 21, 21);
                    padding:5px; /*空間*/
                    margin-top: 15px; 
                    /*letter-spacing: 3px;*/ /*文字間距*/
                }

                /*-- "btn-success"按鈕設定 --*/
                .btn-success{
                    background-color:rgb(43, 141, 48);
                    width:100%;
                    font-size:22px;
                    padding:5px;
                }

                /* 滑鼠懸停時的樣式 */
                .btn-success:hover {
                    color: black; /* 滑鼠懸停時字體顏色變為黑色 */
                }


                /*-- "btn-danger"按鈕設定 --*/
                .btn-danger{
                    width:100%;
                    font-size:22px;
                    padding:5px;
                }

                /* 滑鼠懸停時的樣式 */
                .btn-danger:hover {
                    color: black; /* 滑鼠懸停時字體顏色變為黑色 */
                }

                /*-- "btn-primary"按鈕設定 --*/
                .btn-primary{
                    width:100%;
                    font-size:22px;
                    padding:5px;
                }

                /* 滑鼠懸停時的樣式 */
                .btn-primary:hover {
                    color: black; /* 滑鼠懸停時字體顏色變為黑色 */
                }

                /*-- "btn-info"按鈕設定 --*/
                .btn-info{
                    width:100%;
                    font-size:22px;
                    padding:5px;
                    color: #ffffff
                }

                /* 滑鼠懸停時的樣式 */
                .btn-info:hover {
                    color: black; /* 滑鼠懸停時字體顏色變為黑色 */
                }

                /* 自訂彈出視窗「取消」按鈕樣式 */
                .btn-custom-cancel {
                    background-color: #6c757d; /* 深灰色 */
                    color: #ffffff; /* 白色字體 */
                    width:100%;
                }

                /* 自訂彈出視窗「確認」按鈕樣式 */
                .btn-custom-confirm {
                    background-color: #245aece7; /* 紅色 */
                    color: #ffffff; /* 白色字體 */
                    width:100%;
                }

                input[type="number"]::-webkit-inner-spin-button,
                input[type="number"]::-webkit-outer-spin-button {
                -webkit-appearance: none; /* 移除箭頭樣式 */
                margin: 0; /* 移除內邊距 */
                }
                
    /* 第1部分-數量登記================================================================== */
                .container-1{
                    /*background-color:rgb(158, 238, 243);*/
                    background-image: linear-gradient(to top, #fff1eb 0%, #ace0f9 100%);
                    padding:28px; /*容器空間*/
                    max-width: 800px; 
                    min-width: 100px; 
                    margin-top: 30px; 
                }

                /* span */
                .container-1 .input-group-text {
                    background-color: none; 
                    color: rgb(228, 12, 123);
                    width: 25%;
                    align-items: center;
                    justify-content: center;
                    text-align: center; 
                    font-size: 18px; 
                    letter-spacing: 1px; /*文字間距*/
                    font-weight:600; /*字體粗細100-900*/
                }

                /* input */
                .container-1 .custom{
                    background-color: none; 
                    text-align: center; /*文字置中*/
                    align-items: center;
                    justify-content: center;
                    text-align-last: center; /* 修正選中的文字置中 */
                    appearance: none; /* 移除瀏覽器預設樣式 (選用) */
                    font-size: 20px; 
                    height: 50px;
                }

    /* 第2部分-數量查詢================================================================== */
                .container-2{
                    /*background-color:rgb(158, 238, 243);*/
                    background-image: linear-gradient(to top, #accbee 0%, #e7f0fd 100%);
                    padding:28px; /*容器空間*/
                    max-width: 800px; 
                    min-width: 100px; 
                    margin-top: 0; /* 移除上方間距 */
                }
                
                /* span */
                .container-2 .input-group-text {
                    background-color: none; 
                    color: rgb(11, 148, 4);
                    width: 25%;
                    align-items: center;
                    justify-content: center;
                    text-align: center; 
                    font-size: 18px; 
                    letter-spacing: 1px; /*文字間距*/
                    font-weight:600; /*字體粗細100-900*/
                }

                /* input */
                .container-2 .custom{
                    background-color: none; 
                    text-align: center; /*文字置中*/
                    align-items: center;
                    justify-content: center;
                    text-align-last: center; /* 修正選中的文字置中 */
                    appearance: none; /* 移除瀏覽器預設樣式 (選用) */
                    font-size: 20px; 
                    height: 50px;
                }


    /* 表格調整================================================================== */
                /* 調整表格邊框、欄與列的間距 */
                #resultTable {
                  width: 100%;
                  border-collapse: separate;      /* 為了讓圓角生效 */
                  border-spacing: 0;              /* 清除格子間間距 */
                  border: 1px solid #ddd;         /* 整張表格外框 */
                  border-radius: 10px;            /* 圓角 */
                  overflow: hidden;               /* 防止內容超出圓角 */
                }

                /* 表頭圓角處理 */
                #resultTable thead tr th:first-child {
                  border-top-left-radius: 10px;
                }
                #resultTable thead tr th:last-child {
                  border-top-right-radius: 10px;
                }

                /* 表尾圓角處理 */
                #resultTable tbody tr:last-child td:first-child {
                  border-bottom-left-radius: 10px;
                }
                #resultTable tbody tr:last-child td:last-child {
                  border-bottom-right-radius: 10px;
                }

                /* 表格標題列樣式 */
                #resultTable th {
                    padding: 12px 15px; /* 內邊距：上下12px，左右15px */
                    background-color: #65ae47;
                    border: 1px solid #ddd; /* 淺灰色邊框 */
                    text-align: center;
                }

                /* 表格資料列樣式 */
                #resultTable td {
                    padding: 10px 15px; /* 內邊距：上下10px，左右15px */
                    border: 1px solid #ddd; /* 淺灰色邊框 */
                    text-align: center;
                }

                /* 表格資料列的奇行顏色 */
                #resultTable tr:nth-child(odd) {
                    background-color: #f2f2f2; /* 單數行背景色 */
                }

                /* 表格資料列的偶行顏色 */
                #resultTable tr:nth-child(even) {
                    background-color: #cfcfcf; /* 偶數行的背景顏色 */
                }

                /* 表格總數量行樣式 */
                #resultTable tr:last-child td {
                    font-weight: bold;
                    background-color: #fac400;
                }

    /* 導覽列設定================================================================== */
                /* Navbar 文字顏色 */
                .navbar-dark .navbar-nav .nav-link {
                    color: #ffffff; /* 默認白色文字 */
                    margin: 7px;
                    padding: 5px 10px; /* 內邊距：上下10px，左右15px */
                }

                /* Navbar 文字顏色 hover */
                .navbar-dark .navbar-nav .nav-link:hover {
                    color: #000000; /* 當滑鼠懸停時變成更亮的顏色 */
                    background-color: #ffffff; /* 當滑鼠懸停時背景顏色變化 */
                    border-radius: 5px; /* 當滑鼠懸停時，選單項目加上圓角效果 */
                }

                /* 控制logo圖片的大小和對齊 */
                .navbar-logo {
                    height: 30px;        /* 設置圖片高度 */
                    margin-right: 10px;   /* 右邊距離 */
                    margin-left: 5px;   /* 右邊距離 */
                    vertical-align: middle; /* 讓圖片和文字垂直對齊 */
                }


        </style>

    </head>

    <body>

        <!-- 導覽列 -->
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">
                    <img src="https://kuanlin1218.github.io/CNC_QS/CNC%E5%8A%A0%E5%B7%A5%E6%95%B8%E9%87%8F%E7%B5%B1%E8%A8%88_ver_2/logo_S.png" alt="Logo" class="navbar-logo">
                    詮栩CNC雲端 Ver.2
                </a>
                <!-- <a class="navbar-brand" href="#">詮栩CNC雲端Ver.2</a> -->
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                    aria-controls="navbarNav" aria-expanded="false" aria-label="切換導覽列">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item">
                            <a class="nav-link active" href="#數量登記" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-expanded="false">加工數量登記</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#數量查詢" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-expanded="false">加工數量查詢</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>


        <!-- 第1部分--數量登記 -->
        <section id="數量登記">
            <div class="container container-1">
                <form action="" id="myForm" onsubmit="getValues(event)">
                    <h2> CNC加工數量登記 </h2>
                    <hr>
                    <!-- hr--水平線 -->
                    <!-- 第1列，日期 -->
                    <div class="input-group my-3">
                        <span class="input-group-text">日期</span>
                        <input type="date" id="dt" class="form-control custom" placeholder="YYYY/MM/DD" required>
                    </div>

                    <!-- 第2列，產品編號 -->
                    <div class="input-group my-3">
                        <span class="input-group-text">產品編號</span>
                        <select id="pd" class="form-select custom" required></select>
                    </div>

                    <!-- 第3列，訂單編號 -->
                    <div class="input-group my-3">
                        <span class="input-group-text">訂單編號</span>
                        <select id="or" class="form-select custom" required></select>
                    </div>

                    <!-- 第4列，機台 -->
                    <div class="input-group my-3">
                        <span class="input-group-text">機台編號</span>
                        <select id="mc" class="form-select custom" required></select>
                    </div>

                    <!-- 第5列，時，分 -->
                    <div class="input-group my-3">
                        <span class="input-group-text">時</span>
                        <input type="number" inputmode="decimal" id="hr" placeholder="" class="form-control custom" required>
                        <span class="input-group-text">分</span>
                        <input type="number" inputmode="decimal" id="min" placeholder="" class="form-control custom" required>
                    </div>

                    <!-- 第6列，數量 -->
                    <div class="input-group my-3">
                        <span class="input-group-text">數量</span>
                        <input type="number" inputmode="decimal" id="num" placeholder="" class="form-control custom" required>
                    </div>

                    <!-- 第7列，備註 -->
                    <div class="input-group my-3">
                        <span class="input-group-text">備註</span>
                        <textarea id="comments" placeholder="" class="form-control" name="comments" placeholder="" rows="2"></textarea>
                    </div>
                
                    <hr>
                    <!-- 成功訊息的顯示區域 -->
                    <div class="row">
                        <div class="col-sm-12">
                        <div id="successMessage" class="alert alert-success d-none p-1" role="alert">
                            資料已成功傳送！
                        </div>
                        <!-- 錯誤訊息的顯示區域 -->
                        <div id="errorMessage" class="alert alert-danger d-none p-1" role="alert"></div>
                        </div>
                    </div>

                    <!-- 第9列，送出 -->
                    <div class="row">
                        <div class="col-sm-12">
                                <button type="submit" id="submitButton" class="btn btn-success my-2">
                                    送出
                                </button>
                        </div>
                    </div>

                    <!-- 第10列，刪除最後一筆 -->
                    <div class="row">
                        <div class="col-sm-12">
                            <button type="button" id="deleteButton" class="btn btn-danger my-2">
                                刪除最後一筆
                            </button>
                        </div>
                    </div>
                
                </form>
                
                <br>
            </div>
        </section>

        <!-- 第2部分--數量查詢 -->
        <section id="數量查詢">
            <div class="container container-2">
                <form action="" id="myForm2" onsubmit="searchValues(event)">
                    <h2> CNC加工數量查詢 </h2>
                    <hr>
                    <!-- hr--水平線 -->
                    <!-- 日期 -->
                    <div class="input-group my-3">
                        <span class="input-group-text">開始日期</span>
                        <input type="date" id="dt1" class="form-control custom" placeholder="YYYY/MM/DD" required>
                    </div>

                    <div class="input-group my-3">
                        <span class="input-group-text">結束日期</span>
                        <input type="date" id="dt2" class="form-control custom" placeholder="YYYY/MM/DD" required>
                    </div>

                    <!-- 產品編號 -->
                    <div class="input-group my-3">
                        <span class="input-group-text">產品編號</span>
                        <select id="pd2" class="form-select custom" required></select>
                    </div>

                    <!-- 查詢 -->
                    <div class="row">
                        <div class="col-sm-12">
                                <button type="primary" id="primaryButton" class="btn btn-primary my-2">
                                    查詢
                                </button>
                        </div>
                    </div>

                    <!-- 最後一筆 -->
                    <div class="row">
                        <div class="col-sm-12">
                                <button type="info" id="infoButton" class="btn btn-info my-2" onclick="searchlastValues(event)">
                                    查詢最後一筆
                                </button>
                        </div>
                    </div>

                </form>
                
                <br>

                <!-- 表格 -->
                <table id="resultTable">
                    <thead>
                        <tr>
                            <th>日期</th>
                            <th>產品編號</th>
                            <th>數量</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- 查詢結果會顯示在這裡 -->
                    </tbody>
                </table>

            </div>
        </section>


        <!-- 確認刪除的模態框 -->
        <div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteModalLabel" aria-hidden="true">
            <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                <h5 class="modal-title" id="confirmDeleteModalLabel">確認刪除</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                您確定要刪除最後一筆資料嗎？
                </div>
                <div class="modal-footer">
                <button type="button" class="btn btn-custom-cancel" data-bs-dismiss="modal">取消</button>
                <button type="button" id="confirmDeleteButton" class="btn btn-custom-confirm">確認</button>
                </div>
            </div>
            </div>
        </div>


        <!-- JavaScript程式 -->
        <script>

            // 在頁面載入時載入產品編號和機台
            window.onload = function() {
                //設定昨天日期
                setYesterdayDate('dt');
                setYesterdayDate('dt1');//查詢部分
                setYesterdayDate('dt2');//查詢部分
                
                // 載入產品編號
                google.script.run.withSuccessHandler(populateProductList).getProductList();
                
                // 載入機台
                google.script.run.withSuccessHandler(populate_mc_List).get_mc_List();

                // 載入產品編號2
                google.script.run.withSuccessHandler(populateProductList2).getProductList2();
            };

            // 定義自動設定昨天日期的函數
            function setYesterdayDate(inputId) {
                const today = new Date(); // 取得當前日期
                today.setDate(today.getDate() - 1); // 減去一天得到昨天
                
                // 格式化為 YYYY/MM/DD
                const year = today.getFullYear();
                const month = String(today.getMonth() + 1).padStart(2, '0'); // 月份從 0 開始，所以要加 1
                const day = String(today.getDate()).padStart(2, '0');
                const formattedDate = `${year}-${month}-${day}`; // 組合成所需格式

                const inputElement = document.getElementById(inputId); // 取得目標輸入框
                if (inputElement) {
                    inputElement.value = formattedDate; // 設定日期輸入框的值
                }
            }


    // 登記////////////////////////////////////////////////////////////////////////////////////////

            // 將產品編號選項加入下拉選單
            function populateProductList(data) {
                var pdSelect = document.getElementById("pd");

                // 加入一個空白選項作為初始值
                var emptyOption = document.createElement("option");
                emptyOption.value = "";
                emptyOption.text = "";
                pdSelect.appendChild(emptyOption);

                // 將從工作表抓取的產品編號加入選項
                data.forEach(function(item) {
                    var option = document.createElement("option");
                    option.value = item;
                    option.text = item;
                    pdSelect.appendChild(option);
                });

                // 當產品編號變更時，觸發訂單編號的更新
                pdSelect.addEventListener("change", function() {
                    var selectedProduct = pdSelect.value;
                    populateOrderNumbers(selectedProduct);
                });
            }

            // 根據選取的產品編號填入訂單編號
            function populateOrderNumbers(productNumber) {
                var orSelect = document.getElementById("or");
                orSelect.innerHTML = ""; // 清空現有選項

                // 使用 Google Apps Script API 抓取對應的訂單編號
                google.script.run.withSuccessHandler(function(orderNumbers) {
                    orderNumbers.forEach(function(orderNumber) {
                        var option = document.createElement("option");
                        option.value = orderNumber;
                        option.text = orderNumber;
                        orSelect.appendChild(option);
                    });
                }).getOrderNumbers(productNumber);
            }

            // 將機台選項加入下拉選單
            function populate_mc_List(data) {
                var mcSelect = document.getElementById("mc");

                // 加入一個空白選項作為初始值
                var emptyOption = document.createElement("option");
                emptyOption.value = "";
                emptyOption.text = "";
                mcSelect.appendChild(emptyOption); // 確保這裡是 mcSelect

                // 將從工作表抓取的機台加入選項
                data.forEach(function(item) {
                    var option = document.createElement("option");
                    option.value = item;
                    option.text = item;
                    mcSelect.appendChild(option); // 確保這裡也是 mcSelect
                });
            }

            // 抓輸入的值
            function getValues(event) {
                event.preventDefault(); // 防止表單的預設提交行為

                var dt = document.getElementById("dt");
                var mc = document.getElementById("mc");
                var pd = document.getElementById("pd");
                var or = document.getElementById("or");
                var hr = document.getElementById("hr");
                var min = document.getElementById("min");
                var num = document.getElementById("num");
                var com = document.getElementById("comments");


                // 格式化日期為 YYYY/M/D
                var date = new Date(dt.value);
                var formattedDate = date.getFullYear() + '/' + (date.getMonth() + 1) + '/' + date.getDate();

                // 檢查是否有填寫資料
                if (pd.value === ""|| mc.value === ""|| or.value === ""|| hr.value === ""|| min.value === ""|| num.value === "") {
                    showErrorMessage("資料不完整！");
                    return; // 若值為空白，則停止程式執行
                }


                //抓值
                var rowData = {
                    dt: formattedDate,
                    mc: mc.value,
                    pd: pd.value,
                    or: or.value,
                    hr: hr.value,
                    min: min.value,
                    num: num.value,
                    com: com.value,
                };

                // 上傳資料並處理返回值
                google.script.run.withSuccessHandler(function(result) {
                    console.log('Result from addData:', result); // 輸出結果以檢查
                    if (result) {
                        showSuccessMessage(); // 成功訊息
                    } else {
                        showErrorMessage("已有重複資料！"); // 錯誤訊息
                    }
                }).addData(rowData);

                // 儲存需要保留的值
                var dtValue = dt.value;
                var pdValue = pd.value;
                var mcValue = mc.value;
                var orValue = or.value;

                // 清除表單上的資料
                document.getElementById("myForm").reset();

                // 重新設置保留的值
                dt.value = dtValue;
                pd.value = pdValue;
                mc.value = mcValue;
                or.value = orValue;

            }

            // 顯示成功訊息的函式
            function showSuccessMessage() {
                var successMessage = document.getElementById("successMessage");
                successMessage.classList.remove("d-none");

                // 設定成功訊息在 3 秒後隱藏
                setTimeout(function() {
                    successMessage.classList.add("d-none");
                }, 3000);
            }

            // 顯示錯誤訊息的函式
            function showErrorMessage(message) {
                var errorMessage = document.getElementById("errorMessage");
                errorMessage.textContent = message;
                errorMessage.classList.remove("d-none");

                // 設定錯誤訊息在 3 秒後隱藏
                setTimeout(function() {
                    errorMessage.classList.add("d-none");
                }, 3000);
            }

            // 綁定刪除按鈕以顯示確認模態框
            document.getElementById("deleteButton").addEventListener("click", function() {
                var confirmDeleteModal = new bootstrap.Modal(document.getElementById("confirmDeleteModal"));
                confirmDeleteModal.show();
            });

            // 在確認按鈕點擊後進行刪除
            document.getElementById("confirmDeleteButton").addEventListener("click", function() {
                google.script.run.withSuccessHandler(function(result) {
                    if (result) {
                        showErrorMessage("最後一筆資料已刪除！");
                    } else {
                        showErrorMessage("無法刪除最後一筆資料！");
                    }
                }).deleteLastRow();

                // 隱藏模態框
                var confirmDeleteModal = bootstrap.Modal.getInstance(document.getElementById("confirmDeleteModal"));
                confirmDeleteModal.hide();
            });


    // 查詢////////////////////////////////////////////////////////////////////////////////////////
            
            // 將產品編號選項加入下拉選單
            function populateProductList2(data) {
                var pdSelect = document.getElementById("pd2");

                // 加入一個空白選項作為初始值
                var emptyOption = document.createElement("option");
                emptyOption.value = "";
                emptyOption.text = "";
                pdSelect.appendChild(emptyOption);

                // 將從工作表抓取的產品編號加入選項
                data.forEach(function(item) {
                    var option = document.createElement("option");
                    option.value = item;
                    option.text = item;
                    pdSelect.appendChild(option);
                });
            }
    
            function searchValues(event) {
                event.preventDefault(); // 防止表單的預設提交行為

                var dt1 = document.getElementById("dt1");
                var dt2 = document.getElementById("dt2");
                var pd = document.getElementById("pd2");

                // 格式化日期為 YYYY/M/D
                var date1 = new Date(dt1.value);
                var formattedDate1 = date1.getFullYear() + '/' + (date1.getMonth() + 1) + '/' + date1.getDate();

                var date2 = new Date(dt2.value);
                var formattedDate2 = date2.getFullYear() + '/' + (date2.getMonth() + 1) + '/' + date2.getDate();

                // 檢查是否有填寫資料
                if (pd2.value === "") {
                    alert("資料不完整！");
                    return; // 若值為空白，則停止程式執行
                }

                // 使用 google.script.run 呼叫 GAS 的 getRecordData 方法
                google.script.run.withSuccessHandler(displayRecordData).getRecordData(formattedDate1, formattedDate2, pd2.value);
            }

            // 顯示查詢結果在表格中並加總數量
            function displayRecordData(data) {
                var table = document.getElementById("resultTable");
                var tbody = table.querySelector("tbody"); // 確保填充的是 <tbody> 部分
                tbody.innerHTML = ""; // 清空表格

                // 若沒有查詢結果，顯示訊息
                if (data.length === 0) {
                    var noResult = document.createElement("tr");
                    var td = document.createElement("td");
                    td.colSpan = 3;
                    td.textContent = "沒有符合條件的資料";
                    noResult.appendChild(td);
                    tbody.appendChild(noResult);
                    return;
                }

                // 初始化數量加總
                var totalQuantity = 0;

                // 顯示查詢結果並加總數量
                data.forEach(function(row) {
                    var tr = document.createElement("tr");

                    // 每行遍歷資料
                    row.forEach(function(cell, index) {
                        var td = document.createElement("td");
                        td.textContent = cell;
                        tr.appendChild(td);

                        // 若是數量欄（第三欄），則加總
                        if (index === 2) { // 假設數量在第三欄
                            totalQuantity += parseInt(cell) || 0; // 防止非數字情況，加上預設值0
                        }
                    });

                    tbody.appendChild(tr);
                });

                // 顯示總數量
                var totalRow = document.createElement("tr");
                var td = document.createElement("td");
                td.colSpan = 2; // 跨越兩個欄位
                td.textContent = "總數量";
                totalRow.appendChild(td);

                var totalCell = document.createElement("td");
                totalCell.textContent = totalQuantity; // 顯示總數量
                totalRow.appendChild(totalCell);

                tbody.appendChild(totalRow);
            }



            // 確保點擊導航項目後自動收起 Navbar
            document.querySelectorAll('.navbar-nav .nav-link').forEach(link => {
                link.addEventListener('click', () => {
                    const navbarCollapse = document.getElementById('navbarNav');
                    if (navbarCollapse.classList.contains('show')) {
                        navbarCollapse.classList.remove('show');  // 如果 Navbar 展開，點擊後收起
                    }
                });
            });

            // 平滑滾動效果
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const target = document.querySelector(this.getAttribute('href'));
                    window.scrollTo({
                        top: target.offsetTop - 50, // 可調整偏移量，避免內容被導航列遮擋
                        behavior: 'smooth' // 平滑滾動
                    });
                });
            });


    ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

            function searchlastValues(event) {
              event.preventDefault(); // 防止表單的預設提交行為

              var pd = document.getElementById("pd2");

              // 檢查是否有填寫資料
              if (pd.value === "") {
                alert("資料不完整！");
                return; // 若值為空白，則停止程式執行
              }

              // 使用 google.script.run 呼叫 GAS 的 getLastData 方法
              google.script.run.withSuccessHandler(displayLastData).getLastData(pd.value);
            }

            // 顯示查詢結果在表格中並加總數量
            function displayLastData(data) {
              var table = document.getElementById("resultTable");
              var tbody = table.querySelector("tbody"); // 確保填充的是 <tbody> 部分
              tbody.innerHTML = ""; // 清空表格

              // 若沒有查詢結果，顯示訊息
              if (data.length === 0) {
                var noResult = document.createElement("tr");
                var td = document.createElement("td");
                td.colSpan = 3;
                td.textContent = "沒有符合條件的資料";
                noResult.appendChild(td);
                tbody.appendChild(noResult);
                return;
              }

              // 初始化數量加總
              var totalQuantity = 0;

              // 顯示查詢結果並加總數量
              data.forEach(function(row) {
                var tr = document.createElement("tr");

                // 每行遍歷資料
                row.forEach(function(cell, index) {
                  var td = document.createElement("td");
                  td.textContent = cell;
                  tr.appendChild(td);

                  // 若是數量欄（第三欄），則加總
                  if (index === 2) { // 假設數量在第三欄
                    totalQuantity += parseInt(cell) || 0; // 防止非數字情況，加上預設值0
                  }
                });

                tbody.appendChild(tr);
              });

              // 顯示總數量
              var totalRow = document.createElement("tr");
              var td = document.createElement("td");
              td.colSpan = 2; // 跨越兩個欄位
              td.textContent = "總數量";
              totalRow.appendChild(td);

              var totalCell = document.createElement("td");
              totalCell.textContent = totalQuantity; // 顯示總數量
              totalRow.appendChild(totalCell);

              tbody.appendChild(totalRow);
            }

        </script>
   
    </body>

    
</html>

